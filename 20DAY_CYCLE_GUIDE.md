# 20일 사이클 시스템 가이드

HabbitApp은 **20일 단위 사이클**을 기반으로 습관을 형성하는 앱입니다.

## 🎯 20일 사이클이란?

### 핵심 컨셉
- 습관 형성의 기본 단위는 **20일**입니다
- 각 습관은 20일 사이클로 진행되며, 완료 후 새로운 사이클이 시작됩니다
- **20일 중 15일 이상** 완료하면 해당 사이클을 성공한 것으로 간주합니다

### 왜 20일인가?
1. **실현 가능성**: 21일 법칙에서 영감을 받았지만, 더 유연하게 접근
2. **압박감 감소**: 매일 완벽하게 할 필요 없이 20일 중 15일만 하면 OK
3. **시각화 용이**: 4주(28일)보다 짧고, 2주(14일)보다 긴 적절한 기간

---

## 📊 사이클 관리

### 현재 사이클 정보
각 습관마다 다음 정보를 추적합니다:

```swift
- currentCycle: Int          // 현재 진행 중인 사이클 번호 (1부터 시작)
- completedCycles: Int       // 성공적으로 완료한 사이클 수
- cycleStartDate: Date       // 현재 사이클의 시작일
- cycleEndDate: Date         // 현재 사이클의 종료일
- currentCycleDay: Int       // 현재 Day (1~20)
- completedDays: Int         // 현재 사이클에서 완료한 일수
```

### 사이클 완료 기준
- 20일 중 **15일 이상** 완료 → ✅ 성공
- 15일 미만 완료 → ❌ 실패 (다음 사이클로 진행되지만 카운트 안됨)

---

## 🎨 UI 표시

### 1. 홈 화면 (습관 카드)

각 습관 카드에는 다음 정보가 표시됩니다:

```
┌──────────────────────────────────────┐
│  스페인어 학습                  [12]  │  ← 완료 일수 (원형 진행도)
│  Day 12/20 · 10일 완료                │
│                                       │
│  ○ MINI: 단어 2개                     │
│  ○ MORE: 단어 5개                     │
│  ○ MAX: 단어 10개                     │
│                                       │
│  ┌─────┐  ┌─────┐  ┌─────┐          │
│  │MINI │  │MORE │  │ MAX │          │  ← 오늘의 레벨 선택
│  └─────┘  └─────┘  └─────┘          │
└──────────────────────────────────────┘
```

**원형 진행도 색상:**
- 🔴 빨강 (0~25% 완료)
- 🟠 오렌지 (25~50% 완료)
- 🔵 파랑 (50~75% 완료)
- 🟢 초록 (75~100% 완료)

### 2. Small 위젯

```
┌────────────────────┐
│ 스페인어 학습  [10]│  ← 미니 원형 진행도
│ Day 12/20          │
│                    │
│                    │
│ ● ● ●              │  ← 오늘의 완료 상태
└────────────────────┘
```

### 3. Medium 위젯

```
┌───────────────────────────────────────┐
│ 오늘의 습관                            │
│                                        │
│ 스페인어 학습           Day 12/20      │
│ ● ● ●              ▓▓▓▓▓▓░░░░ 50%    │  ← 진행도 바
│                                        │
│ 운동하기                Day 9/20       │
│ ● ○ ○              ▓▓▓░░░░░░░ 35%    │
└───────────────────────────────────────┘
```

### 4. Large 위젯 (20일 달력)

```
┌────────────────────────────────────────┐
│ 스페인어 학습            Day 12/20      │
│                                 50%     │
│ ─────────────────────────────────      │
│                                         │
│  1   2   3   4   5                     │  ← 20일 달력 그리드
│ ███ ███ ███ ███ ░░░                    │
│                                         │
│  6   7   8   9  10                     │
│ ███ ███ ███ ███ ███                    │
│                                         │
│ 11  12  13  14  15                     │
│ ███ [12] ░░░ ░░░ ░░░                   │  ← [오늘]
│                                         │
│ 16  17  18  19  20                     │
│ ░░░ ░░░ ░░░ ░░░ ░░░                    │
│                                         │
│ █ MINI  █ MORE  █ MAX  ░ 미완료       │  ← 범례
└────────────────────────────────────────┘
```

**달력 색상:**
- 🟢 민트 (`#8FD5C1`): MINI 완료
- 🔵 블루 (`#5A9BD4`): MORE 완료
- 🟣 보라 (`#9B6FC5`): MAX 완료
- ⚪ 회색: 미완료 또는 미래 날짜
- 🔵 테두리: 오늘 날짜

---

## 💻 주요 API

### HabitViewModel

```swift
// 현재 사이클 시작일
func getCurrentCycleStartDate(for habit: Habit) -> Date

// 현재 사이클 종료일
func getCurrentCycleEndDate(for habit: Habit) -> Date

// 현재 사이클의 Day (1~20)
func getCurrentCycleDay(for habit: Habit) -> Int

// 현재 사이클의 20일 기록 가져오기
func getCurrentCycleRecords(for habit: Habit) -> [DailyRecord?]

// 현재 사이클의 완료 일수
func getCurrentCycleCompletedDays(for habit: Habit) -> Int

// 현재 사이클의 완료율 (0.0 ~ 1.0)
func getCurrentCycleCompletionRate(for habit: Habit) -> Double

// 사이클 완료 여부 확인 및 업데이트
func checkAndUpdateCycleCompletion(for habit: Habit)

// 총 완료한 사이클 수
func getTotalCompletedCycles(for habit: Habit) -> Int
```

---

## 🔄 사이클 전환

### 자동 전환
- 20일이 지나면 자동으로 다음 사이클로 전환됩니다
- 앱을 열 때마다 `checkAndUpdateCycleCompletion()`이 호출되어 사이클 상태를 업데이트합니다

### 성공 판정
```swift
// 20일 중 15일 이상 완료했다면 성공
if completedDays >= 15 {
    habit.completedCycles += 1  // 성공 카운트 증가
}
habit.currentCycle += 1  // 다음 사이클로 진행
```

---

## 📈 통계 및 분석

### 습관 상세 화면에서 볼 수 있는 정보:

1. **현재 사이클 정보**
   - Day X/20
   - 완료 일수
   - 완료율

2. **전체 통계**
   - 총 진행 일수
   - 총 완료율
   - 성공한 사이클 수

3. **20일 달력**
   - 현재 사이클의 20일 기록
   - 각 날짜의 완료 상태 (MINI/MORE/MAX/미완료)

---

## 🎯 사용 시나리오

### 시나리오 1: 첫 사이클 시작
```
Day 1:  ✅ MINI 완료
Day 2:  ✅ MORE 완료
Day 3:  ❌ 미완료
...
Day 20: ✅ MAX 완료

결과: 16일 완료 → ✅ 사이클 성공!
```

### 시나리오 2: 사이클 실패
```
Day 1-10:  7일 완료
Day 11-20: 6일 완료

결과: 13일 완료 → ❌ 사이클 실패
      (하지만 다음 사이클 시작)
```

### 시나리오 3: 여러 사이클 완료
```
Cycle 1: 17일 완료 → ✅ 성공
Cycle 2: 19일 완료 → ✅ 성공
Cycle 3: 14일 완료 → ❌ 실패
Cycle 4: 18일 완료 → ✅ 성공

총 성공한 사이클: 3개
```

---

## 🔧 개발자 노트

### 날짜 계산 로직
```swift
// 현재 사이클 인덱스 계산
let daysSinceStart = 시작일부터 오늘까지의 일수
let currentCycleIndex = daysSinceStart / 20

// 현재 사이클 시작일
let cycleStartDate = startDate + (currentCycleIndex * 20일)

// 현재 Day
let currentDay = (오늘 - cycleStartDate) + 1
```

### 위젯 데이터 업데이트
- 위젯은 매일 자정에 자동으로 업데이트됩니다
- `TimelineProvider`의 `getTimeline()` 메서드에서 다음 날 자정을 계산하여 설정

---

## 💡 팁

### 사용자를 위한 팁
1. **완벽주의 벗어나기**: 20일 중 15일만 하면 성공입니다!
2. **유연하게 목표 선택**: 바쁜 날은 MINI, 여유로운 날은 MAX
3. **위젯 활용**: 홈 화면에 Large 위젯을 추가하여 진행 상황을 한눈에 확인
4. **연속성보다 일관성**: 며칠 쉬어도 괜찮아요, 전체 20일 중 15일이 목표입니다

### 개발자를 위한 팁
1. **사이클 전환 타이밍**: 앱 실행 시 항상 `checkAndUpdateCycleCompletion()` 호출
2. **날짜 계산 주의**: 타임존과 일광절약시간을 고려하여 `Calendar.startOfDay()` 사용
3. **위젯 데이터 동기화**: App Group을 통해 메인 앱과 위젯이 동일한 SwiftData 컨테이너 사용
4. **성능 최적화**: 위젯에서는 최대 20일(=작은 배열)만 다루므로 성능 이슈 없음

---

## 🚀 향후 계획

- [ ] 사이클 완료 시 축하 애니메이션
- [ ] 성공한 사이클 배지 시스템
- [ ] 여러 사이클 통계 차트
- [ ] 친구와 사이클 진행 상황 공유
- [ ] 사이클 목표 커스터마이징 (예: 18/20일)

---

**20일이면 충분합니다. 완벽하지 않아도 괜찮아요! 🌟**
